"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t){d[e]={onStart:t.onStart||u,onMove:t.onMove||u,onStop:t.onStop||u,onDrop:t.onDrop||u,onDragover:t.onDragover||u,onDragleave:t.onDragleave||u,onDragenter:t.onDragenter||u}}function t(e,t,o){for(var i=y(e),n=i.top,a=i.left,l=i.width,r=i.height,s=a+l/2,p=n+r/2,c=0,d=null,f=null,u=0,h=0,g=0,b=0;c<t.length;c++)d=t[c],f=d.measureData,u=f.top,h=f.left,g=f.width,b=f.height,s>h&&s<h+g&&p>u&&p<u+b?d.isEntered?o.overCallback&&o.overCallback(e,d):(d.isEntered=!0,o.enterCallback&&o.enterCallback(e,d)):d.isEntered&&(d.isEntered=!1,o.leaveCallback&&o.leaveCallback(e,d))}function o(e,t){var o=document.createElement("div");return o.className="paint-rect",o.dataset._painting=!0,o.dataset.paintifyblock=!0,o.style.left=e+"px",o.style.top=t+"px",o.style.cssText+="background: #99E9FC;width: 0px;height: 0px;position: absolute;opacity: 0.5;cursor: move;",o}function i(e){e.onmousemove=function(t){if(!c){var o=e.style,i=e.dataset,n=y(e),a=n.top,l=n.left,p=n.width,d=n.height,f=t.pageX,u=t.pageY,h=r.offsetLeft,g=r.offsetTop,b=f-h-l,v=l+p-(f-h),m=u-g-a,k=a+d-(u-g);b>0&&b<s?m<s?(i.direction="lt",o.cursor="nwse-resize"):k<s?(i.direction="lb",o.cursor="nesw-resize"):(i.direction="l",o.cursor="ew-resize"):v<s?m<s?(i.direction="rt",o.cursor="nesw-resize"):k<s?(i.direction="rb",o.cursor="nwse-resize"):(i.direction="r",o.cursor="ew-resize"):m>0&&m<s?(i.direction="t",o.cursor="ns-resize"):k<s?(i.direction="b",o.cursor="ns-resize"):(i.direction="c",o.cursor="move")}}}function n(e){e.onmousemove=function(t){c||(e.dataset.direction="c",e.style.cursor="move")}}function a(e,t,o){e.oncontextmenu=function(i){for(var n=i.target,a=!1,l=n;l!==e;){if(l.dataset.paintifyblock){a=!0;break}l=l.parentNode}return a?t&&t(l):o&&o(n),!1}}function l(e){var t=e.style;e.dataset.beforemeasure=JSON.stringify({top:t.top,left:t.left,width:t.width,height:t.height,zIndex:t.zIndex}),e.reset=function(){var e=this.dataset.beforemeasure&&JSON.parse(this.dataset.beforemeasure);this.style.top=e.top,this.style.left=e.left,this.style.width=e.width,this.style.height=e.height,this.style.zIndex=e.zIndex}}var r=null,s=10,p=0,c=null,d={},f=[],u=function(){},h=function(e,t){return document.defaultView.getComputedStyle(e,!1)[t]},y=function(e){return{top:h(e,"top")&&parseInt(h(e,"top").replace(/px/,""),10),left:h(e,"left")&&parseInt(h(e,"left").replace(/px/,""),10),height:h(e,"height")&&parseInt(h(e,"height").replace(/px/,""),10),width:h(e,"width")&&parseInt(h(e,"width").replace(/px/,""),10)}},g=function(u){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=void 0,b=void 0,v=void 0,m=void 0,k=void 0,x=void 0,w=void 0,_=null,S=(h.blocks||[],void 0!==h.count?h.count:-1),C=h.resize,D=h.move,X=(h.drop,h.onBlockContextMenu),Y=h.onContextMenu;s=h.distance?h.distance:s,r=u,u.style.userSelect="none",u.style.webkitUserSelect="none","static"===window.getComputedStyle(u).position&&(u.style.position="relative",console.warn("Note: container's position(css) is static, changed it into relative")),(X||Y)&&a(u,X,Y);var z=function(t){console.log("down"),g=t.pageX,b=t.pageY,k=t.pageX,x=t.pageY,_=t.target;for(var a=!1;_!==u;){if(_.dataset.paintifyblock){a=!0;break}_=_.parentNode}if(_.combineDom=[],_.combine=function(e){_.combineDom.push(e),l(e)},_.clearCombine=function(e){_.combineDom=[]},a)c=_,w=_.dataset.direction,v=g-_.offsetLeft,m=b-_.offsetTop,l(_),d[_.dataset.paintifyblock_id]&&d[_.dataset.paintifyblock_id].onStart(_);else{var r=u.querySelector("[data-_painting]")||[];if(r.length<S||S<0){var s=o(g,b);u.appendChild(s),C&&D?i(s):D&&n(s),s.dataset.paintifyblock_id=++p,e(p,h),_=s,d[p]&&d[p].onStart(s)}else _=null}},I=function(e){if(console.log("move"),_&&_.isOver===!0&&(_=null),null!==_){if(!c)return _.style.width=e.pageX-g+"px",_.style.height=e.pageY-b+"px",void(d[_.dataset.paintifyblock_id]&&d[_.dataset.paintifyblock_id].onMove(_));var o=function(o,i){switch(i){case"c":h&&(o.style.top=parseInt(o.style.top.replace("px",""),10)+T+"px"),S&&(o.style.left=parseInt(o.style.left.replace("px",""),10)+B+"px");break;case"lt":o.style.left=I+"px",o.style.top=M+"px",o.style.width=D+"px",o.style.height=Y+"px",k=e.pageX,x=e.pageY;break;case"rt":o.style.top=M+"px",o.style.width=X+"px",o.style.height=Y+"px",k=e.pageX,x=e.pageY;break;case"t":o.style.top=M+"px",o.style.height=Y+"px",x=e.pageY;break;case"lb":L||(o.style.left=I+"px",o.style.width=D+"px"),!O&&(o.style.height=z+"px"),k=e.pageX,x=e.pageY;break;case"rb":!j&&(o.style.width=X+"px"),!O&&(o.style.height=z+"px"),k=e.pageX,x=e.pageY;break;case"b":!O&&(o.style.height=z+"px"),x=e.pageY;break;case"l":L||(o.style.left=I+"px",o.style.width=D+"px"),k=e.pageX;break;case"r":!j&&(o.style.width=X+"px"),k=e.pageX}f&&t(o,f,{overCallback:function(e,t){d[t.paintifyblock_id].onDragover(e,t.dom)},enterCallback:function(e,t){d[t.paintifyblock_id].onDragenter(e,t.dom)},leaveCallback:function(e,t){d[t.paintifyblock_id].onDragleave(e,t.dom)}})},i=_,n=i.offsetHeight,a=i.offsetWidth,l=u.offsetHeight,r=u.offsetWidth,s=e.pageX-v,p=e.pageY-m,h=n+p<=l&&p>=0,S=a+s<=r&&s>=0,C=y(i),D=C.width-(e.pageX-k),X=C.width+(e.pageX-k),Y=C.height-(e.pageY-x),z=C.height+(e.pageY-x),I=e.pageX-v>=0?e.pageX-v:0,M=e.pageY-m>=0?e.pageY-m:0,N=C.left,E=C.top,j=X+N>r,L=D+N>r,O=z+E>l,T=M-E,B=I-N;o(i,w),d[i.dataset.paintifyblock_id]&&d[i.dataset.paintifyblock_id].onMove(i);for(var H=0,W=null;H<_.combineDom.length;H++)W=_.combineDom[H],o(W,w),d[W.dataset.paintifyblock_id]&&d[W.dataset.paintifyblock_id].onMove(W)}},M=function(){if(console.log("leave"),null!==_){var e=!1;f&&t(_,f,{overCallback:function(t,o){e=!0,console.log("isInBox",e),d[o.paintifyblock_id].onDrop(t,o.dom)}}),d[_.dataset.paintifyblock_id]&&d[_.dataset.paintifyblock_id].onStop(_,{isInBox:e}),l(_),_.clearCombine&&_.clearCombine(),_=null,c=null}};u.onmousedown=z,u.onmousemove=I,u.onmouseleave=M,u.onmouseup=M};g.prototype={paint:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.prototype.toString.call(t);"[object Array]"!==a&&"[object NodeList]"!==a&&(t=[t]);for(var l=o.resize,r=o.move,s=o.drop,c=[],d=0,u=null;d<t.length;d++){if(u=t[d],!u)return;u.dataset.paintifyblock_id=++p,e(p,o),u.dataset.paintifyblock=!0,l&&r?i(u):r&&n(u),"absolute"!==window.getComputedStyle(u).position&&c.push({paintifyblock_id:p,dom:u,left:u.offsetLeft,top:u.offsetTop,width:u.offsetWidth,height:u.offsetHeight})}c.map(function(e,t){var o=e.dom;o.style.position="absolute",o.style.top=e.top+"px",o.style.left=e.left+"px",o.style.margin=0,s&&f.push({paintifyblock_id:e.paintifyblock_id,dom:o,measureData:{left:e.left,top:e.top,width:e.width,height:e.height}})})}},"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=g:window.Paintify=g}();