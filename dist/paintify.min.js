"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t){u[e]={onStart:t.onStart||y,onMove:t.onMove||y,onStop:t.onStop||y,onDrop:t.onDrop||y,onDragover:t.onDragover||y,onDragleave:t.onDragleave||y,onDragenter:t.onDragenter||y}}function t(e,t,o){for(var i=b(e),n=i.top,a=i.left,l=i.width,r=i.height,s=a+l/2,p=n+r/2,c=0,d=null,f=null,u=0,h=0,y=0,g=0;c<t.length;c++)d=t[c],f=d.measureData,u=f.top,h=f.left,y=f.width,g=f.height,s>h&&s<h+y&&p>u&&p<u+g?d.isEntered?o.overCallback&&o.overCallback(e,d):(d.isEntered=!0,o.enterCallback&&o.enterCallback(e,d)):d.isEntered&&(d.isEntered=!1,o.leaveCallback&&o.leaveCallback(e,d))}function o(e,t){var o=document.createElement("div");return o.className="paint-rect",o.dataset._painting=!0,o.dataset.paintifyblock=!0,o.style.left=e+"px",o.style.top=t+"px",o.style.cssText+="background: #99E9FC;width: 0px;height: 0px;position: absolute;opacity: 0.5;cursor: move;",o}function i(e){e.onmousemove=function(t){if(!f){var o=e.style,i=e.dataset,n=b(e),a=n.top,l=n.left,r=n.width,s=n.height,d=t.pageX,u=t.pageY,h=p.offsetLeft,y=p.offsetTop,g=d-h-l,v=l+r-(d-h),m=u-y-a,k=a+s-(u-y);g>0&&g<c?m<c?(i.direction="lt",o.cursor="nwse-resize"):k<c?(i.direction="lb",o.cursor="nesw-resize"):(i.direction="l",o.cursor="ew-resize"):v<c?m<c?(i.direction="rt",o.cursor="nesw-resize"):k<c?(i.direction="rb",o.cursor="nwse-resize"):(i.direction="r",o.cursor="ew-resize"):m>0&&m<c?(i.direction="t",o.cursor="ns-resize"):k<c?(i.direction="b",o.cursor="ns-resize"):(i.direction="c",o.cursor="move")}}}function n(e){e.onmousemove=function(t){f||(e.dataset.direction="c",e.style.cursor="move")}}function a(e,t,o){e.oncontextmenu=function(i){for(var n=i.target,a=!1,l=n;l!==e;){if(l.dataset.paintifyblock){a=!0;break}l=l.parentNode}return a?t&&t(l):o&&o(n),!1}}function l(e){var t=e.style;e.dataset.beforemeasure=JSON.stringify({top:t.top,left:t.left,width:t.width,height:t.height,zIndex:t.zIndex}),e.reset=function(){var e=this.dataset.beforemeasure&&JSON.parse(this.dataset.beforemeasure);this.style.top=e.top,this.style.left=e.left,this.style.width=e.width,this.style.height=e.height,this.style.zIndex=e.zIndex}}function r(e){var t=e.dataset.paintifyblock_id;return m[t]&&m[t].combine||[]}function s(e){var t=e.dataset.paintifyblock_id;m[t]&&m[t].combine&&delete m[t].combine}var p=null,c=10,d=0,f=null,u={},h=[],y=function(){},g=function(e,t){return document.defaultView.getComputedStyle(e,!1)[t]},b=function(e){return{top:g(e,"top")&&parseInt(g(e,"top").replace(/px/,""),10),left:g(e,"left")&&parseInt(g(e,"left").replace(/px/,""),10),height:g(e,"height")&&parseInt(g(e,"height").replace(/px/,""),10),width:g(e,"width")&&parseInt(g(e,"width").replace(/px/,""),10)}},v=function(y){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=void 0,m=void 0,k=void 0,x=void 0,w=void 0,_=void 0,S=void 0,C=null,X=(g.blocks||[],void 0!==g.count?g.count:-1),Y=g.resize,z=g.move,D=(g.drop,g.onBlockContextMenu),I=g.onContextMenu;c=g.distance?g.distance:c,p=y,y.style.userSelect="none",y.style.webkitUserSelect="none","static"===window.getComputedStyle(y).position&&(y.style.position="relative",console.warn("Note: container's position(css) is static, changed it into relative")),(D||I)&&a(y,D,I);var M=function(t){v=t.pageX,m=t.pageY,w=t.pageX,_=t.pageY,C=t.target;for(var a=!1;C!==y;){if(C.dataset.paintifyblock){a=!0;break}C=C.parentNode}if(a)f=C,S=C.dataset.direction,k=v-C.offsetLeft,x=m-C.offsetTop,l(C),u[C.dataset.paintifyblock_id]&&u[C.dataset.paintifyblock_id].onStart(C);else{var r=y.querySelector("[data-_painting]")||[];if(r.length<X||X<0){var s=o(v,m);y.appendChild(s),Y&&z?i(s):z&&n(s),s.dataset.paintifyblock_id=++d,e(d,g),C=s,u[d]&&u[d].onStart(s)}else C=null}},N=function(e){if(C&&C.isOver===!0&&(C=null),null!==C){if(!f)return C.style.width=e.pageX-v+"px",C.style.height=e.pageY-m+"px",void(u[C.dataset.paintifyblock_id]&&u[C.dataset.paintifyblock_id].onMove(C));var o=function(o,i){switch(i){case"c":c&&(o.style.top=parseInt(o.style.top.replace("px",""),10)+T+"px"),d&&(o.style.left=parseInt(o.style.left.replace("px",""),10)+B+"px");break;case"lt":o.style.left=I+"px",o.style.top=M+"px",o.style.width=X+"px",o.style.height=z+"px",w=e.pageX,_=e.pageY;break;case"rt":o.style.top=M+"px",o.style.width=Y+"px",o.style.height=z+"px",w=e.pageX,_=e.pageY;break;case"t":o.style.top=M+"px",o.style.height=z+"px",_=e.pageY;break;case"lb":L||(o.style.left=I+"px",o.style.width=X+"px"),!O&&(o.style.height=D+"px"),w=e.pageX,_=e.pageY;break;case"rb":!j&&(o.style.width=Y+"px"),!O&&(o.style.height=D+"px"),w=e.pageX,_=e.pageY;break;case"b":!O&&(o.style.height=D+"px"),_=e.pageY;break;case"l":L||(o.style.left=I+"px",o.style.width=X+"px"),w=e.pageX;break;case"r":!j&&(o.style.width=Y+"px"),w=e.pageX}h&&t(o,h,{overCallback:function(e,t){u[t.paintifyblock_id].onDragover(e,t.dom)},enterCallback:function(e,t){u[t.paintifyblock_id].onDragenter(e,t.dom)},leaveCallback:function(e,t){u[t.paintifyblock_id].onDragleave(e,t.dom)}})},i=C.offsetHeight,n=C.offsetWidth,a=y.offsetHeight,l=y.offsetWidth,s=e.pageX-k,p=e.pageY-x,c=i+p<=a&&p>=0,d=n+s<=l&&s>=0,g=b(C),X=g.width-(e.pageX-w),Y=g.width+(e.pageX-w),z=g.height-(e.pageY-_),D=g.height+(e.pageY-_),I=e.pageX-k>=0?e.pageX-k:0,M=e.pageY-x>=0?e.pageY-x:0,N=g.left,E=g.top,j=Y+N>l,L=X+N>l,O=D+E>a,T=M-E,B=I-N;o(C,S),u[C.dataset.paintifyblock_id]&&u[C.dataset.paintifyblock_id].onMove(C);for(var H=0,W=null,J=r(C);H<J.length;H++)W=J[H],o(W,S),u[W.dataset.paintifyblock_id]&&u[W.dataset.paintifyblock_id].onMove(W)}},E=function(){if(null!==C){var e=!1;h&&t(C,h,{overCallback:function(t,o){e=!0,console.log("isInBox",e),u[o.paintifyblock_id].onDrop(t,o.dom)}}),u[C.dataset.paintifyblock_id]&&u[C.dataset.paintifyblock_id].onStop(C,{isInBox:e}),l(C);for(var o=0,i=null,n=r(C);o<n.length;o++)i=n[o],l(i);s(C),C=null,f=null}};y.onmousedown=M,y.onmousemove=N,y.onmouseleave=E,y.onmouseup=E},m={id:{combine:[]}};v.prototype={paint:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.prototype.toString.call(t);"[object Array]"!==a&&"[object NodeList]"!==a&&(t=[t]);for(var l=o.resize,r=o.move,s=o.drop,p=[],c=0,f=null;c<t.length;c++){if(f=t[c],!f)return;f.dataset.paintifyblock_id=++d,e(d,o),f.dataset.paintifyblock=!0,l&&r?i(f):r&&n(f),"absolute"!==window.getComputedStyle(f).position&&p.push({paintifyblock_id:d,dom:f,left:f.offsetLeft,top:f.offsetTop,width:f.offsetWidth,height:f.offsetHeight})}p.map(function(e,t){var o=e.dom;o.style.position="absolute",o.style.top=e.top+"px",o.style.left=e.left+"px",o.style.margin=0,s&&h.push({paintifyblock_id:e.paintifyblock_id,dom:o,measureData:{left:e.left,top:e.top,width:e.width,height:e.height}})})},combine:function(e,t){var o=e.dataset.paintifyblock_id;m[o]=m[o]?m[o]:{},m[o].combine=m[o].combine?m[o].combine:[],m[o].combine.push(t)},getCombined:function(e){return r(e)},uncombine:function(e){s(e)}},"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=v:window.Paintify=v}();