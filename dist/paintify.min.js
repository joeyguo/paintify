"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t){h[e]={onStart:t.onStart||v,onMove:t.onMove||v,onStop:t.onStop||v,onDrop:t.onDrop||v,onDragover:t.onDragover||v,onDragleave:t.onDragleave||v,onDragenter:t.onDragenter||v}}function t(e,t,o){for(var n=b(e),i=n.top,a=n.left,r=n.width,s=n.height,p=a+r/2,l=i+s/2,d=0,c=null,u=null,f=0,h=0,g=0,y=0;d<t.length;d++)c=t[d],u=c.measureData,f=u.top,h=u.left,g=u.width,y=u.height,p>h&&p<h+g&&l>f&&l<f+y?c.isEntered?o.overCallback&&o.overCallback(e,c):(c.isEntered=!0,o.enterCallback&&o.enterCallback(e,c)):c.isEntered&&(c.isEntered=!1,o.leaveCallback&&o.leaveCallback(e,c))}function o(e,t){var o=document.createElement("div");return o.className="paint-rect",o.dataset._painting=!0,o.style.left=e+"px",o.style.top=t+"px",o.style.cssText+="background: #99E9FC;width: 0px;height: 0px;position: absolute;opacity: 0.5;cursor: move;",o}function n(e){e.onmousemove=function(t){if(!f){var o=e.style,n=e.dataset,i=b(e),a=i.top,r=i.left,s=i.width,p=i.height,l=t.pageX,u=t.pageY,h=d.offsetLeft,g=d.offsetTop,y=l-h-r,v=r+s-(l-h),m=u-g-a,x=a+p-(u-g);y>0&&y<c?m<c?(n.direction="lt",o.cursor="nwse-resize"):x<c?(n.direction="lb",o.cursor="nesw-resize"):(n.direction="l",o.cursor="ew-resize"):v<c?m<c?(n.direction="rt",o.cursor="nesw-resize"):x<c?(n.direction="rb",o.cursor="nwse-resize"):(n.direction="r",o.cursor="ew-resize"):m>0&&m<c?(n.direction="t",o.cursor="ns-resize"):x<c?(n.direction="b",o.cursor="ns-resize"):(n.direction="c",o.cursor="move")}}}function i(e){e.onmousemove=function(t){f||(e.dataset.direction="c",e.style.cursor="move")}}function a(e,t,o){e.oncontextmenu=function(n){for(var i=n.target,a=!1,r=i;r!==e;){if(r.dataset.paintid){a=!0;break}r=r.parentNode}return a?t&&t(r):o&&o(i),!1}}function r(e){var t=e.dataset.paintid,o=e.style;y[t]=y[t]?y[t]:{},y[t].measure=[],y[t].measure.push({top:o.top,left:o.left,width:o.width,height:o.height,zIndex:o.zIndex})}function s(e){var t=e.dataset.paintid;return y[t]=y[t]?y[t]:{},y[t].measure=y[t].measure?y[t].measure:[],y[t].measure.pop()}function p(e){var t=e.dataset.paintid;return y[t]&&y[t].combine||[]}function l(e){var t=e.dataset.paintid;y[t]&&y[t].combine&&delete y[t].combine}var d=null,c=10,u=0,f=null,h={},g=[],y={id:{combine:[],measure:[]}},v=function(){},m=function(e,t){return document.defaultView.getComputedStyle(e,!1)[t]},b=function(e){return{top:m(e,"top")&&parseInt(m(e,"top").replace(/px/,""),10),left:m(e,"left")&&parseInt(m(e,"left").replace(/px/,""),10),height:m(e,"height")&&parseInt(m(e,"height").replace(/px/,""),10),width:m(e,"width")&&parseInt(m(e,"width").replace(/px/,""),10)}},x=function(s){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=void 0,m=void 0,x=void 0,w=void 0,k=void 0,S=void 0,C=void 0,X=null,Y=(y.blocks||[],void 0!==y.count?y.count:-1),z=y.resize,D=y.move,I=(y.drop,y.onBlockContextMenu),M=y.onContextMenu;c=y.distance?y.distance:c,d=s,s.style.userSelect="none",s.style.webkitUserSelect="none","static"===window.getComputedStyle(s).position&&(s.style.position="relative",console.warn("Note: container's position(css) is static, changed it into relative")),(I||M)&&a(s,I,M);var E=function(t){console.log("down"),v=t.pageX,m=t.pageY,k=t.pageX,S=t.pageY,X=t.target;for(var a=!1;X!==s;){if(X.dataset.paintid){a=!0;break}X=X.parentNode}if(a)f=X,C=X.dataset.direction,x=v-X.offsetLeft,w=m-X.offsetTop,r(X),h[X.dataset.paintid]&&h[X.dataset.paintid].onStart(X);else{var p=s.querySelector("[data-_painting]")||[];if(p.length<Y||Y<0){var l=o(v,m);s.appendChild(l),z&&D?n(l):D&&i(l),l.dataset.paintid=++u,e(u,y),X=l,h[u]&&h[u].onStart(l)}else X=null}},N=function(e){if(console.log("move"),X&&X.isOver===!0&&(X=null),null!==X){if(!f)return X.style.width=e.pageX-v+"px",X.style.height=e.pageY-m+"px",void(h[X.dataset.paintid]&&h[X.dataset.paintid].onMove(X));var o=function(o,n){switch(n){case"c":c&&(o.style.top=parseInt(o.style.top.replace("px",""),10)+B+"px"),u&&(o.style.left=parseInt(o.style.left.replace("px",""),10)+H+"px");break;case"lt":o.style.left=M+"px",o.style.top=E+"px",o.style.width=Y+"px",o.style.height=D+"px",k=e.pageX,S=e.pageY;break;case"rt":o.style.top=E+"px",o.style.width=z+"px",o.style.height=D+"px",k=e.pageX,S=e.pageY;break;case"t":o.style.top=E+"px",o.style.height=D+"px",S=e.pageY;break;case"lb":T||(o.style.left=M+"px",o.style.width=Y+"px"),!_&&(o.style.height=I+"px"),k=e.pageX,S=e.pageY;break;case"rb":!L&&(o.style.width=z+"px"),!_&&(o.style.height=I+"px"),k=e.pageX,S=e.pageY;break;case"b":!_&&(o.style.height=I+"px"),S=e.pageY;break;case"l":T||(o.style.left=M+"px",o.style.width=Y+"px"),k=e.pageX;break;case"r":!L&&(o.style.width=z+"px"),k=e.pageX}g&&t(o,g,{overCallback:function(e,t){h[t.paintid].onDragover(e,t.dom)},enterCallback:function(e,t){h[t.paintid].onDragenter(e,t.dom)},leaveCallback:function(e,t){h[t.paintid].onDragleave(e,t.dom)}})},n=X.offsetHeight,i=X.offsetWidth,a=s.offsetHeight,r=s.offsetWidth,l=e.pageX-x,d=e.pageY-w,c=n+d<=a&&d>=0,u=i+l<=r&&l>=0,y=b(X),Y=y.width-(e.pageX-k),z=y.width+(e.pageX-k),D=y.height-(e.pageY-S),I=y.height+(e.pageY-S),M=e.pageX-x>=0?e.pageX-x:0,E=e.pageY-w>=0?e.pageY-w:0,N=y.left,j=y.top,L=z+N>r,T=Y+N>r,_=I+j>a,B=E-j,H=M-N;o(X,C),h[X.dataset.paintid]&&h[X.dataset.paintid].onMove(X);for(var W=0,O=null,q=p(X);W<q.length;W++)O=q[W],o(O,C),h[O.dataset.paintid]&&h[O.dataset.paintid].onMove(O)}},j=function(){if(null!==X){var e=!1;g&&t(X,g,{overCallback:function(t,o){e=!0,console.log("isInBox",e),h[o.paintid].onDrop(t,o.dom)}}),h[X.dataset.paintid]&&h[X.dataset.paintid].onStop(X,{isInBox:e}),r(X);for(var o=0,n=null,i=p(X);o<i.length;o++)n=i[o],r(n);l(X),X=null,f=null}};s.onmousedown=E,s.onmousemove=N,s.onmouseleave=j,s.onmouseup=j};x.prototype={paint:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.prototype.toString.call(t);"[object Array]"!==a&&"[object NodeList]"!==a&&(t=[t]);for(var r=o.resize,s=o.move,p=o.drop,l=[],d=0,c=null;d<t.length;d++){if(c=t[d],!c)return;c.dataset.paintid=++u,e(u,o),r&&s?n(c):s&&i(c),"absolute"!==window.getComputedStyle(c).position&&l.push({paintid:u,dom:c,left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight})}l.map(function(e,t){var o=e.dom;o.style.position="absolute",o.style.top=e.top+"px",o.style.left=e.left+"px",o.style.margin=0,p&&g.push({paintid:e.paintid,dom:o,measureData:{left:e.left,top:e.top,width:e.width,height:e.height}})})},reset:function(e){var t=s(e);e.style.top=t.top,e.style.left=t.left,e.style.width=t.width,e.style.height=t.height,e.style.zIndex=t.zIndex},combine:function(e,t){var o=e.dataset.paintid;y[o]=y[o]?y[o]:{},y[o].combine=y[o].combine?y[o].combine:[],y[o].combine.push(t)},getCombined:function(e){return p(e)},uncombine:function(e){l(e)}},"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=x:window.Paintify=x}();