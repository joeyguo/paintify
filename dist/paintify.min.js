"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t){d[e]={onStart:t.onStart||c,onMove:t.onMove||c,onStop:t.onStop||c,onDrop:t.onDrop||c,onDragover:t.onDragover||c,onDragleave:t.onDragleave||c,onDragenter:t.onDragenter||c}}function t(e,t,o){for(var i=y(e),n=i.top,a=i.left,l=i.width,r=i.height,s=a+l/2,p=n+r/2,c=0,f=null,d=null,u=0,h=0,g=0,b=0;c<t.length;c++)f=t[c],d=f.measureData,u=d.top,h=d.left,g=d.width,b=d.height,s>h&&s<h+g&&p>u&&p<u+b?f.isEntered?o.overCallback&&o.overCallback(e,f):(f.isEntered=!0,o.enterCallback&&o.enterCallback(e,f)):f.isEntered&&(f.isEntered=!1,o.leaveCallback&&o.leaveCallback(e,f))}function o(e,t){var o=document.createElement("div");return o.className="paint-rect",o.dataset._painting=!0,o.dataset.paintifyblock=!0,o.style.left=e+"px",o.style.top=t+"px",o.style.cssText+="background: #99E9FC;width: 0px;height: 0px;position: absolute;opacity: 0.5;cursor: move;",o}function i(e){e.onmousemove=function(t){if(!f){var o=e.style,i=e.dataset,n=y(e),a=n.top,l=n.left,p=n.width,c=n.height,d=t.pageX,u=t.pageY,h=r.offsetLeft,g=r.offsetTop,b=d-h-l,v=l+p-(d-h),m=u-g-a,x=a+c-(u-g);b>0&&b<s?m<s?(o.cursor="nwse-resize",i.direction="lt"):x<s?(i.direction="lb",o.cursor="nesw-resize"):(i.direction="l",o.cursor="ew-resize"):v<s?m<s?(i.direction="rt",o.cursor="nesw-resize"):x<s?(i.direction="rb",o.cursor="nwse-resize"):(i.direction="r",o.cursor="ew-resize"):m>0&&m<s?(i.direction="t",o.cursor="ns-resize"):x<s?(i.direction="b",o.cursor="ns-resize"):(i.direction="c",o.cursor="move")}}}function n(e){e.onmousemove=function(t){f||(e.dataset.direction="c",e.style.cursor="move")}}function a(e,t,o){e.oncontextmenu=function(i){for(var n=i.target,a=!1,l=n;l!==e;){if(l.dataset.paintifyblock){a=!0;break}l=l.parentNode}return a?t&&t(l):o&&o(n),!1}}function l(e){var t=e.style;e.dataset.beforemeasure=JSON.stringify({top:t.top,left:t.left,width:t.width,height:t.height,zIndex:t.zIndex}),e.reset=function(){var e=this.dataset.beforemeasure&&JSON.parse(this.dataset.beforemeasure);this.style.top=e.top,this.style.left=e.left,this.style.width=e.width,this.style.height=e.height,this.style.zIndex=e.zIndex}}var r=null,s=10,p=0,c=function(){},f=null,d={},u=[],h=function(e,t){return document.defaultView.getComputedStyle(e,!1)[t]},y=function(e){return{top:h(e,"top")&&parseInt(h(e,"top").replace(/px/,""),10),left:h(e,"left")&&parseInt(h(e,"left").replace(/px/,""),10),height:h(e,"height")&&parseInt(h(e,"height").replace(/px/,""),10),width:h(e,"width")&&parseInt(h(e,"width").replace(/px/,""),10)}},g=function(c){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=void 0,b=void 0,v=void 0,m=void 0,x=void 0,k=void 0,w=void 0,D=null,S=(h.blocks||[],void 0!==h.count?h.count:-1),_=h.resize,C=h.move,X=(h.drop,h.onBlockContextMenu),Y=h.onContextMenu;s=h.distance?h.distance:s,r=c,c.style.userSelect="none",c.style.webkitUserSelect="none","static"===window.getComputedStyle(c).position&&(c.style.position="relative",console.warn("Note: container's position(css) is static, changed it into relative")),(X||Y)&&a(c,X,Y);var z=function(t){console.log("down"),g=t.pageX,b=t.pageY,x=t.pageX,k=t.pageY,D=t.target;for(var a=!1;D!==c;){if(D.dataset.paintifyblock){a=!0;break}D=D.parentNode}if(D.combineDom=[],D.combine=function(e){D.combineDom.push(e),l(e)},D.clearCombine=function(e){D.combineDom=[]},a)f=D,w=D.dataset.direction,v=g-D.offsetLeft,m=b-D.offsetTop,l(D),d[D.dataset.paintifyblock_id]&&d[D.dataset.paintifyblock_id].onStart(D);else{var r=c.querySelector("[data-_painting]")||[];if(r.length<S||S<0){var s=o(g,b);c.appendChild(s),_&&C?i(s):C&&n(s),s.dataset.paintifyblock_id=++p,e(p,h),D=s,d[p]&&d[p].onStart(s)}else D=null}},I=function(e){if(console.log("move"),D&&D.isOver===!0&&(D=null),null!==D){if(!f)return D.style.width=e.pageX-g+"px",D.style.height=e.pageY-b+"px",void(d[D.dataset.paintifyblock_id]&&d[D.dataset.paintifyblock_id].onMove(D));var o=function(o,i){switch(i){case"c":h&&(o.style.top=parseInt(o.style.top.replace("px",""),10)+T+"px"),S&&(o.style.left=parseInt(o.style.left.replace("px",""),10)+B+"px");break;case"lt":o.style.left=I+"px",o.style.top=N+"px",o.style.width=C+"px",o.style.height=Y+"px",x=e.pageX,k=e.pageY;break;case"rt":o.style.top=N+"px",o.style.width=X+"px",o.style.height=Y+"px",x=e.pageX,k=e.pageY;break;case"t":o.style.top=N+"px",o.style.height=Y+"px",k=e.pageY;break;case"lb":L||(o.style.left=I+"px",o.style.width=C+"px"),!O&&(o.style.height=z+"px"),x=e.pageX,k=e.pageY;break;case"rb":!j&&(o.style.width=X+"px"),!O&&(o.style.height=z+"px"),x=e.pageX,k=e.pageY;break;case"b":!O&&(o.style.height=z+"px"),k=e.pageY;break;case"l":L||(o.style.left=I+"px",o.style.width=C+"px"),x=e.pageX;break;case"r":!j&&(o.style.width=X+"px"),x=e.pageX}u&&t(o,u,{overCallback:function(e,t){d[t.paintifyblock_id].onDragover(e,t.dom)},enterCallback:function(e,t){d[t.paintifyblock_id].onDragenter(e,t.dom)},leaveCallback:function(e,t){d[t.paintifyblock_id].onDragleave(e,t.dom)}})},i=D,n=i.offsetHeight,a=i.offsetWidth,l=c.offsetHeight,r=c.offsetWidth,s=e.pageX-v,p=e.pageY-m,h=n+p<=l&&p>=0,S=a+s<=r&&s>=0,_=y(i),C=_.width-(e.pageX-x),X=_.width+(e.pageX-x),Y=_.height-(e.pageY-k),z=_.height+(e.pageY-k),I=e.pageX-v>=0?e.pageX-v:0,N=e.pageY-m>=0?e.pageY-m:0,E=_.left,M=_.top,j=X+E>r,L=C+E>r,O=z+M>l,T=N-M,B=I-E;o(i,w);for(var H=0;H<D.combineDom.length;H++)o(D.combineDom[H],w);d[i.dataset.paintifyblock_id]&&d[i.dataset.paintifyblock_id].onMove(i)}},N=function(){if(console.log("leave"),null!==D){var e=!1;u&&t(D,u,{overCallback:function(t,o){e=!0,console.log("isInBox",e),d[o.paintifyblock_id].onDrop(t,o.dom)}}),d[D.dataset.paintifyblock_id]&&d[D.dataset.paintifyblock_id].onStop(D,{isInBox:e}),l(D),D.clearCombine&&D.clearCombine(),D=null,f=null}};c.onmousedown=z,c.onmousemove=I,c.onmouseleave=N,c.onmouseup=N};g.prototype={paint:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.prototype.toString.call(t);"[object Array]"!==a&&"[object NodeList]"!==a&&(t=[t]);for(var l=o.resize,r=o.move,s=o.drop,f=[],d=0,h=null;d<t.length;d++){if(h=t[d],!h)return;h.dataset.paintifyblock_id=++p,e(p,o),h.dataset.paintifyblock=!0,l&&r?i(h):r&&n(h),"absolute"!==window.getComputedStyle(h).position&&f.push({paintifyblock_id:p,dom:h,left:h.offsetLeft,top:h.offsetTop,width:h.offsetWidth,height:h.offsetHeight})}f.map(function(e,t){var i=e.dom;i.style.position="absolute",i.style.top=e.top+"px",i.style.left=e.left+"px",i.style.margin=0,s&&u.push({paintifyblock_id:e.paintifyblock_id,dom:i,measureData:{left:e.left,top:e.top,width:e.width,height:e.height},onDrop:o.onDrop||c,onDragover:o.onDragover||c})})}},"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=g:window.Paintify=g}();